<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/quiz.css" />
    <title>Document</title>
  </head>

  <body>
    <header>
      <h1>Color Master</h1>
    </header>

    <div class="time" class="hidden">
      <p id="time">⌛GOGO⌛</p>
    </div>
    <div class="score">
      <p>score:</p>
      <p id="score">0</p>
    </div>
    <div class="box">
      <div class="common" onclick="select(this)"></div>
      <div class="common" onclick="select(this)"></div>
      <div class="common" onclick="select(this)"></div>
      <div class="common" onclick="select(this)"></div>
      <div class="common" onclick="select(this)"></div>
      <div class="common" onclick="select(this)"></div>
    </div>

    <footer>
      <script>
        //check dificult by URL
        var currentURL = window.location.href;
        var dificult, modeNum, corectValue;
        var common = document.getElementsByClassName("common");
        var r, g, b, rgb, uniRGB;
        //Generate a unique selection.
        var uniqueClassNum = Math.floor(Math.random() * common.length);
        common[uniqueClassNum].classList.add("unique");
        var unique = document.getElementsByClassName("unique");
        //CheckingMode.
        var time = 10;
        var life = 3;

        //Generate a rgb to apply in css.
        color = () => {
          r = Math.floor(Math.random() * 256); // generates a random value for red (0-255)
          g = Math.floor(Math.random() * 256); // generates a random value for green (0-255)
          b = Math.floor(Math.random() * 256); // generates a random value for blue (0-255)
          return "rgb(" + r + "," + g + "," + b + ")";
        };

        //Checking over css rgb value.
        rOverMax = () => {
          return ((r + modeNum) > 255)? (r - modeNum):(r + modeNum)
        };
        gOverMax = () => {
          return ((g + modeNum) > 255)? (g - modeNum):(g + modeNum)
        };
        bOverMax = () => {
          return ((b + modeNum) > 255)? (b - modeNum):(b + modeNum)
        };

        generateUnique = () => {
          console.log(rOverMax(), rgb);
          console.log(gOverMax(), rgb);
          console.log(bOverMax(), rgb);

          return (
            "rgb(" +
            (rOverMax() % 256) +
            "," +
            (gOverMax() % 256) +
            "," +
            (bOverMax() % 256) +
            ")"
          );
        };

        //Plus a score by checking the mode. also active action.
        select = (current) => {
          var score = Number(document.getElementById("score").innerHTML);

          if (current.classList.contains("unique")) {
            document.getElementById("score").innerHTML = score + 7;              
          }
          if (currentURL.includes("3life")) {
            life-=1;
          }
          
          //Changethe unique selection.
          unique[0].classList.remove("unique");
          uniqueClassNum = Math.floor(Math.random() * common.length);
          common[uniqueClassNum].classList.add("unique");

          //Change ther color.
          rgb = color(r, g, b);
          for (var i = 0; i < common.length; i++) {
            common[i].style.backgroundColor = rgb;
          }
          unique[0].style.backgroundColor = generateUnique(r, g, b, modeNum);
        };

        //Checking current dificult
        if (currentURL.includes("easy")) {
          modeNum = 127;
          corectValue = 7;
        } else if (currentURL.includes("normal")) {
          modeNum = 63;
          corectValue = 10;
        } else {
          modeNum = 31;
          corectValue = 15;
        }

        //CheckingMode
        if (currentURL.includes("10sec")) {
          var timeElement = document.getElementById("time");
          timeElement.classList.remove("hideden");
          const countdown = setInterval(() => {
            timeElement.innerText = time;
            time--;
            if (time < 0) {
              clearInterval(countdown);
              var score = document.getElementById("score").innerHTML;
              localStorage.setItem("resultScore", score);
              const xhr = new XMLHttpRequest();
              xhr.open("GET", "/result");
              xhr.send();
              window.location.href = "/result";
            }
          }, 1000);
        } else if (currentURL.includes("3life")) {
          var lifeElement = document.getElementById("life");
          lifeElement.classList.remove("hidden");
          if (life <1 ) {
            const xhr = new XMLHttpRequst();
            xhr.open("GET", "/result");
            xhr.send();
            window.location.href="/result";
          }
        }

        //Apply color.
        rgb = color(r, g, b);
        for (var i = 0; i < common.length; i++) {
          common[i].style.backgroundColor = rgb;
        }
        uniRGB = generateUnique(r, g, b, modeNum);
        unique[0].style.backgroundColor = uniRGB;
      </script>
    </footer>
  </body>
</html>
